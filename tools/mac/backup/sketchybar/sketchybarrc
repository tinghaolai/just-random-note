#!/bin/bash

# =======================================
# SketchyBar: Dock-like Custom Layout
# =======================================

bar_color=0xee1e1e2e
icon_color=0xffc0caf5
highlight_color=0xff00ffff
highlight_color2=0xffff0090
alert_color=0xffff5555
font="SF Pro Text:Bold:18.0"

# bar Ê∞∏ÈÅ†ÁΩÆ‰∏≠„ÄÅÂ∫ïÈÉ®„ÄÅÊúÄ‰∏äÂ±§„ÄÅÂÖ®Ëû¢ÂπïÈ°ØÁ§∫
sketchybar --bar height=42 color=$bar_color position=bottom y_offset=5 \
           layer=overlay topmost=on show_in_fullscreen=on

# üî• Ê∏ÖÁ©∫ÊâÄÊúâÈ†ÖÁõÆÔºàË¶ÅÊîæÂú®ÊúÄÂâçÈù¢Êâç‰∏çÊúÉÊää battery Âà™ÊéâÔºâ
sketchybar --remove all

# =======================================
# BatteryÔºàÊúÄÂ∑¶Ôºâ
# =======================================
sketchybar --add item battery left \
           --set battery \
                icon="Û±ä£" \
                icon.color=0xffd7ff00 \
                icon.font="Glitch Goblin:Bold:18.0" \
                label.font="Glitch Goblin:Bold:14.0" \
                label.color=0xffd7ff00 \
                label.padding_left=12 \
                label.padding_right=12 \
                update_freq=20 \
                script="~/.config/sketchybar/plugins/battery.sh"


# =======================================
# VolumeÔºàbattery Âè≥ÂÅ¥Ôºâ
# =======================================
sketchybar --add item volume left \
           --insert volume after battery \
           --set volume \
                icon="Û∞ïæ" \
                icon.font="Glitch Goblin:Bold:18.0" \
                label.font="Glitch Goblin:Bold:14.0" \
                label.padding_left=12 \
                label.padding_right=12 \
                update_freq=20


# =======================================
# VPN ÁãÄÊÖãÔºàvolume Âè≥ÂÅ¥Ôºâ
# =======================================
sketchybar --add item vpn left \
           --insert vpn after volume \
           --set vpn \
                icon="Û∞ØÑ" \
                icon.font="Glitch Goblin:Bold:18.0" \
                label.font="Glitch Goblin:Bold:14.0" \
                label.padding_left=12 \
                label.padding_right=12 \
                update_freq=20


# =======================================
# Function: Add App
# =======================================
function add_app() {
  local name=$1
  local icon=$2
  local app_name=$3

  if [[ "$app_name" == "Slack" ]]; then
    sketchybar --add item $name center
    sketchybar --set $name icon=$icon \
                          icon.color=$icon_color \
                          icon.font="$font" \
                          icon.padding_left=10 \
                          icon.padding_right=10 \
                          label.drawing=on \
                          click_script='
                            if [ "$BUTTON" = "right" ]; then
                              osascript -e "quit app \"'"$app_name"'\""
                            else
                              open -a "'"$app_name"'"
                            fi
                          ' \
                          script="~/.config/sketchybar/plugins/app_status.sh '$app_name' $name" \
                          update_freq=5
  else
    sketchybar --add item $name center
    sketchybar --set $name icon=$icon \
                          icon.color=$icon_color \
                          icon.font="$font" \
                          icon.padding_left=10 \
                          icon.padding_right=10 \
                          label.drawing=off \
                          click_script='
                            if [ "$BUTTON" = "right" ]; then
                              osascript -e "quit app \"'"$app_name"'\""
                            else
                              open -a "'"$app_name"'"
                            fi
                          '
  fi
}

# =======================================
# App Icon List
# =======================================
add_app finder "Û∞Ä∂" "Finder"
add_app launchpad "Û∞Äª" "Launchpad"
add_app system "Û∞íìÔ∏è" "System Settings"
add_app chrome "Û∞äØ" "Google Chrome"
add_app datagrip "Û∞Üº" "DataGrip"
add_app phpstorm "Û∞Ö©" "PhpStorm"
add_app tabby "Û∞Üç" "Tabby"
add_app chatgpt "Û∞ö©" "ChatGPT"
add_app postman "Û±é¥" "Postman"
add_app line "Û∞≠π" "LINE"
add_app slack "Û∞í±" "Slack"
add_app goland "Û∞üì" "GoLand"
add_app vscode "Û∞®û" "Visual Studio Code"
add_app webstorm "Û∞ñü" "WebStorm"
add_app karabiner "Û∞åå" "Karabiner-Elements"
add_app pycharm "Û∞å†" "PyCharm"
add_app bongocat "Û∞Ñõ" "BongoCat"

# =======================================
# Front App indicator
# =======================================
sketchybar --add event front_app_switched
sketchybar --add item frontapp center \
           --set frontapp script="~/.config/sketchybar/plugins/frontapp.sh" \
                          drawing=off \
                          updates=on
sketchybar --subscribe frontapp front_app_switched


# =======================================
# Clock
# =======================================
sketchybar --add item clock center \
           --insert clock after bongocat \
           --set clock \
                  icon.drawing=off \
                  label.color=$highlight_color2 \
                  label.font="$font" \
                  label.padding_left=15 \
                  update_freq=30 \
                  script="~/.config/sketchybar/plugins/clock.sh"

sketchybar --update clock


# =======================================
# Input Source & Workspace
# =======================================
sketchybar --add item input_source center \
           --insert input_source after clock \
           --set input_source \
                icon.drawing=off \
                label.color=0xffffd700 \
                label.font="SF Pro Text:Bold:12.0" \
                label.padding_left=10 \
                label.padding_right=10 \
                script="~/.config/sketchybar/plugins/input_source.sh"

sketchybar --add item ws_indicator center \
           --insert ws_indicator after input_source \
           --set ws_indicator \
                icon.drawing=off \
                label.font="SF Pro Text:Bold:12.0" \
                label.color=0xff8be9fd \
                label.padding_left=10 \
                label.padding_right=10 \
                update_freq=1 \
                script="~/.config/sketchybar/plugins/ws_indicator.sh"

sketchybar --add event aerospace_workspace_changed
sketchybar --subscribe ws_indicator aerospace_workspace_changed

sketchybar --add event input_source_changed
sketchybar --subscribe input_source input_source_changed
